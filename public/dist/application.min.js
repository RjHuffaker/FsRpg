"use strict";var ApplicationConfiguration=function(){var applicationModuleName="fsrpg",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","btford.socket-io"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("campaigns"),ApplicationConfiguration.registerModule("cards"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("decks"),ApplicationConfiguration.registerModule("npcs"),ApplicationConfiguration.registerModule("pcs"),ApplicationConfiguration.registerModule("users"),angular.module("campaigns").controller("CampaignsController",["$scope","Socket",function($scope,Socket){$scope.messages=[],$scope.users=[];var init=function(){$scope.name=window.user.username,$scope.messages.push({user:"",text:$scope.name+" has joined."}),Socket.emit("user:init",{name:window.user.username})};Socket.on("user:init",function(data){console.log(data);for(var message in data.messages)$scope.messages.push(message);for(var user in data.users)$scope.users.push(user)}),Socket.on("send:message",function(message){$scope.messages.push(message)}),Socket.on("user:join",function(data){$scope.messages.push({user:"",text:data.name+" has joined."}),$scope.users.push(data.name)}),Socket.on("user:left",function(data){$scope.messages.push({user:"chatroom",text:data.name+" has left."})}),$scope.messages=[],$scope.sendMessage=function(){$scope.message&&(Socket.emit("send:message",{user:$scope.name,text:$scope.message}),$scope.messages.push({user:$scope.name,text:$scope.message}),$scope.message="")},init()}]),angular.module("campaigns").factory("Campaigns",["$stateParams","$location","Authentication","$resource",function($stateParams,$location,Authentication,$resource){var Campaigns=$resource("campaigns/:campaignId",{campaignId:"@_id"},{update:{method:"PUT"}}),service={};return service.campaign={},service.campaignList=[],service.browseCampaigns=function(){this.campaignList=Campaigns.query(function(response){})},service.readCampaign=function(){this.campaign=Campaigns.get({campaignId:$stateParams.campaignId})},service.editCampaign=function(){var campaign=this.campaign;campaign.$update(function(){},function(errorResponse){this.error=errorResponse.data.message})},service.addCampaign=function(){this.campaign=new Campaigns({}),this.campaign.$save(function(response){$location.path("campaign/campaigns/"+response._id+"/edit")},function(errorResponse){this.error=errorResponse.data.message})},service.deleteCampaign=function(campaign){if(campaign){campaign.$remove();for(var i in this.campaigns)this.campaigns[i]===campaign&&this.campaigns.splice(i,1)}else this.campaign.$remove(function(){$location.path("campaign/campaigns")});this.browseCampaigns()},service}]),angular.module("cards").directive("cardForm",["$rootScope",function($rootScope){return{restrict:"A",require:"^form",link:function(scope,element,attr){scope.$on("BREAD: deckSaved",function(){scope.featureCardForm.$setPristine()})}}}]).directive("cardLogo",["$rootScope",function($rootScope){return{restrict:"A",templateUrl:"../modules/cards/views/card-logo.html"}}]).directive("cardHeader",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-header.html"}}).directive("cardDescription",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-description.html"}}).directive("cardModifiers",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-modifiers.html"}}).directive("cardBenefit",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-benefit.html"}}).directive("cardFooter",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-footer.html"}}).directive("cardAction",["DataSRVC",function(DataSRVC){return{restrict:"A",templateUrl:"../modules/cards/views/card-action.html",scope:{cardAction:"=",panel:"="},link:function(scope,element,attrs){scope.dataSRVC=DataSRVC}}}]).directive("cardActionIcon",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-action-icon.html"}}).directive("cardActionTitle",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-action-title.html"}}).directive("cardActionKeywords",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-action-keywords.html"}}).directive("cardActionPrompt",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-action-prompt.html"}}).directive("cardActionEffect",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-action-effect.html"}}).directive("cardActionAttack",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-action-attack.html"}}).directive("cardActionDefense",function(){return{restrict:"A",templateUrl:"../modules/cards/views/card-action-defense.html"}}).directive("originStats",function(){return{restrict:"A",templateUrl:"../modules/cards/views/origin-stats.html"}}).directive("originDefenses",function(){return{restrict:"A",templateUrl:"../modules/cards/views/origin-defenses.html"}}).directive("diceDropdown",function(){return{restrict:"A",templateUrl:"../modules/pcs/views/dice-dropdown.html",scope:{ability:"="}}}).directive("stopEvent",function(){return{restrict:"A",link:function(scope,element,attrs){var _pressEvents="touchstart mousedown";element.on(_pressEvents,function(event){scope.panel.x_overlap||scope.panel.y_overlap||event.stopPropagation()})}}}).directive("stopClick",function(){return{restrict:"A",link:function(scope,element,attrs){element.on("click",function(event){event.stopPropagation()})}}}).directive("elasticTextarea",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){var resizeArea=function(){setTimeout(function(){element[0].style.height=element[0].scrollHeight+"px"},25)};scope.$watch(function(){return element[0].scrollHeight},function(newValue,oldValue){newValue!==oldValue&&resizeArea()}),resizeArea()}}}]).directive("fitContent",function(){return{restrict:"A",scope:!1,link:function(scope,element,attrs){var reduceText=function(){setTimeout(function(){for(var fontSize=parseInt(element.css("font-size"));element[0].offsetHeight>element.parent()[0].offsetHeight&&fontSize>=6;)fontSize--,element.css("font-size",fontSize+"px")},25)};scope.$watch(function(){return element[0].offsetHeight},function(newValue,oldValue){newValue>oldValue&&reduceText()}),reduceText()}}}),angular.module("cards").directive("playerOptions",function(){return{restrict:"A",templateUrl:"../modules/core/views/options-player.html"}}).directive("pcSummary",function(){return{restrict:"A",templateUrl:"../modules/pcs/views/pc-summary.html"}}).directive("pcOptions",function(){return{restrict:"A",templateUrl:"../modules/pcs/views/pc-options.html"}}).directive("cardPc1",function(){return{restrict:"A",templateUrl:"../modules/pcs/views/card-pc-1.html"}}).directive("cardPc2",function(){return{restrict:"A",templateUrl:"../modules/pcs/views/card-pc-2.html"}}).directive("cardPc3",function(){return{restrict:"A",templateUrl:"../modules/pcs/views/card-pc-3.html"}}).directive("featureCard",["DataSRVC","BREAD",function(DataSRVC,BREAD){return{restrict:"A",templateUrl:"../modules/cards/views/feature-card.html",scope:{card:"=",panel:"="},link:function(scope,element,attrs){scope.BREAD=BREAD,scope.dataSRVC=DataSRVC}}}]).directive("narratorOptions",function(){return{restrict:"A",templateUrl:"../modules/core/views/options-narrator.html"}}).directive("npcSummary",function(){return{restrict:"A",templateUrl:"../modules/npcs/views/npc-summary.html"}}).directive("npcOptions",function(){return{restrict:"A",templateUrl:"../modules/npcs/views/npc-options.html"}}).directive("npcOrigin",function(){return{restrict:"A",templateUrl:"../modules/npcs/views/npc-origin.html"}}).directive("architectOptions",function(){return{restrict:"A",templateUrl:"../modules/core/views/options-architect.html"}}).directive("deckSummary",function(){return{restrict:"A",templateUrl:"../modules/decks/views/deck-summary.html"}}).directive("deckOptions",function(){return{restrict:"A",templateUrl:"../modules/decks/views/deck-options.html"}}).directive("campaignSummary",function(){return{restrict:"A",templateUrl:"../modules/campaigns/views/campaign-summary.html"}}).directive("campaignOptions",function(){return{restrict:"A",templateUrl:"../modules/campaigns/views/campaign-options.html"}}),angular.module("cards").factory("Aspects",["$resource",function($resource){return $resource("aspect/:aspectId",{aspectId:"@_id"},{update:{method:"PUT"},list:{url:"/aspects",method:"GET",isArray:!0},query:{url:"/aspects/:deckId",method:"GET",isArray:!0,params:{deckId:"@_id"}}})}]),angular.module("cards").factory("Augments",["$resource",function($resource){return $resource("augments/:augmentId",{augmentId:"@_id"},{update:{method:"PUT"}})}]),angular.module("cards").factory("Feats",["$resource",function($resource){return $resource("feats/:featId",{featId:"@_id"},{update:{method:"PUT"}})}]),angular.module("cards").factory("Items",["$resource",function($resource){return $resource("items/:itemId",{itemId:"@_id"},{update:{method:"PUT"}})}]),angular.module("cards").factory("Origins",["$resource",function($resource){return $resource("origins/:originId",{originId:"@_id"},{update:{method:"PUT"}})}]),angular.module("cards").factory("Traits",["$resource",function($resource){return $resource("traits/:traitId",{traitId:"@_id"},{update:{method:"PUT"}})}]),angular.module("cards").factory("traitService",["Cards","CardDeck",function(Cards,CardDeck){var service={};return service}]),angular.module("cards").factory("Cards",["$stateParams","$location","Authentication","$resource","$rootScope",function($stateParams,$location,Authentication,$resource,$rootScope){var Cards=$resource("cards/:cardId:cardType",{cardId:"@_id"},{update:{method:"PUT"}}),service={};service.cardList=[],service.cardType="trait",service.cardNew=!1,service.cardSaved=!1;var optionsPanel={cardType:service.cardType,optionsPanel:!0};return service.lockCard=function(card){card.locked=!0},service.unlockCard=function(card){card.locked=!1},service.setCardList=function(){for(var i=0;i<service.cardList.length;i++)this.cardList[i].cardRole="architect",this.cardList[i].locked=!1,this.cardList[i].x_coord=15*i,this.cardList[i].y_coord=0,this.cardList[i].dragging=!1,this.cardList[i].stacked=!1},service.changeDurability=function(card,add){add&&card.durability.modifier<4?card.durability.modifier+=1:!add&&card.durability.modifier>0&&(card.durability.modifier-=1)},service.changeSpeed=function(card,add){add&&card.speed.modifier<1?card.speed.modifier+=1:!add&&card.speed.modifier>-1&&(card.speed.modifier-=1)},service.changeFinesse=function(card,add){add&&card.finesse.modifier<0?card.finesse.modifier+=1:!add&&card.finesse.modifier>-2&&(card.finesse.modifier-=1)},service.changeWeight=function(card,add){add&&card.weight<9?card.weight+=1:!add&&card.weight>0&&(card.weight-=1)},service.changeCost=function(card,add){add&&card.cost<18?card.cost+=1:!add&&card.cost>0&&(card.cost-=1)},service.browseCards=function(cardType){return service.cardType=cardType,service.cardList=Cards.query({cardType:cardType},function(response){service.cardList.unshift(optionsPanel),service.setCardList()}),{cardList:service.cardList}},service.readCard=function(card){card=Cards.get({cardId:card._id}),service.unlockCard(card)},service.editCard=function(card){card.$update(function(response){service.unlockCard(card)},function(errorResponse){console.log(errorResponse)})},service.addCard=function(cardNumber){var index;index=1>cardNumber?service.cardList.length:cardNumber,this.card=new Cards({cardRole:"architect",cardType:service.cardType,cardNumber:index,dragging:!1,stacked:!1}),this.card.$save(function(response){for(var i in service.cardList)service.cardList[i].cardNumber>=index&&(service.cardList[i].cardNumber+=1,service.cardList[i].x_coord+=15,service.cardList[i].$update());service.cardList.push(service.card),service.setCardList()},function(errorResponse){console.log(errorResponse)})},service.deleteCard=function(card){if(card){console.log("Delete:"),console.log(card),card.$remove();for(var i in service.cardList)service.cardList[i]===card&&(console.log("Delete:"),console.log(service.cardList[i]),service.cardList.splice(i,1)),service.cardList[i]&&service.cardList[i].cardNumber>card.cardNumber&&(console.log("reordering "+service.cardList[i].cardNumber+" / "+card.cardNumber),service.cardList[i].cardNumber-=1);return service.setCardList(),{cardList:service.cardList}}},service}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("CoreController",["$location","$scope","$rootScope","$window","Authentication","CardDeck","BREAD","DataSRVC","PcsCard1","PcsCard2","PcsCard3","PcsTraits","PcsFeats","PcsAugments","PcsItems",function($location,$scope,$rootScope,$window,Authentication,CardDeck,BREAD,DataSRVC,PcsCard1,PcsCard2,PcsCard3,PcsTraits,PcsFeats,PcsAugments,PcsItems){$scope.authentication=Authentication,$scope.cardDeck=CardDeck,$scope.BREAD=BREAD,$scope.dataSRVC=DataSRVC,$scope.pcsCard1=PcsCard1,$scope.pcsCard2=PcsCard2,$scope.pcsCard3=PcsCard3,$scope.pcsTraits=PcsTraits,$scope.pcsFeats=PcsFeats,$scope.pcsAugments=PcsAugments,$scope.pcsItems=PcsItems,$scope.modalShown=!1,$scope.diceBoxShown=!1,$scope.modalDeckShown=!1;var pcNew=!1,fetchPcs=function(){BREAD.browsePcs()},fetchCards=function(event,object){BREAD.browseCards(object.cardType)},fetchDecks=function(event,object){BREAD.browseDecks(object.deckType,BREAD.resource)},initialize=function(){toggleListeners(!0)},toggleListeners=function(enable){enable&&($scope.$on("$destroy",onDestroy),$scope.$on("screenSize:onHeightChange",onHeightChange),$scope.$on("fetchPcs",fetchPcs),$scope.$on("fetchCards",fetchCards),$scope.$on("fetchDecks",fetchDecks),$scope.$on("ability:onPress",chooseAbility),$scope.$on("pcsCard1:updateAbility",updateAbility),$scope.$watch("pcsCard2.EXP",watchEXP),$scope.$watch("BREAD.resource.experience",watchExperience),$scope.$watch("BREAD.resource.level",watchLevel))},onDestroy=function(){toggleListeners(!1)},onHeightChange=function(event,object){$scope.windowHeight=object.newHeight,$scope.windowScale=object.newScale,$scope.$digest()};$scope.newPc=function(){BREAD.addPc(),pcNew=!0},$scope.readPc=function(pc){BREAD.readPc(pc),pcNew=!1},$scope.readDeck=function(deck){BREAD.readDeck(deck)},$scope.savePc=function(pc){BREAD.editPc(pc),pcNew=!1},$scope.exitPc=function(){pcNew&&BREAD.deletePc(),fetchPcs()},$scope.hideModal=function(){$scope.modalShown=!1,$scope.diceBoxShown=!1,$scope.modalDeckShown=!1},$scope.changeFeatureCard=function(card){$scope.modalShown=!0,$scope.modalDeckShown=!0,PcsTraits.browseCards()},$scope.status={isopen:!1},$scope.toggled=function(open){$scope.status.isopen=open,$rootScope.$broadcast("CardsCtrl:onDropdown",{isOpen:$scope.status.isopen})};var chooseAbility=function(event,object){$scope.modalShown=!0,$scope.diceBoxShown=!0},updateAbility=function(event,object){var abilityPair=object.abilityPair,ability1=object.ability1,ability2=object.ability2;switch(abilityPair){case 1:PcsCard1.factorBlock(ability1,ability2),PcsCard2.factorHealth(),PcsCard2.factorStamina(),PcsCard2.factorCarryingCapacity();break;case 2:PcsCard1.factorDodge(ability1,ability2);break;case 3:PcsCard1.factorAlertness(ability1,ability2);break;case 4:PcsCard1.factorTenacity(ability1,ability2)}$scope.modalShown=!1,$scope.diceBoxShown=!1},watchEXP=function(newValue,oldValue){BREAD.resource&&newValue!==oldValue&&(PcsCard2.EXP=parseInt(newValue),BREAD.resource.experience=parseInt(newValue))},watchExperience=function(newValue,oldValue){BREAD.resource&&newValue!==oldValue&&(PcsCard2.factorExperience(),newValue!==PcsCard2.EXP&&(PcsCard2.EXP=newValue))},watchLevel=function(newValue,oldValue){BREAD.resource.abilities&&(PcsCard2.factorHealth(),PcsCard2.factorStamina(),PcsTraits.factorTraitLimit(),PcsFeats.factorFeatLimit(),PcsAugments.factorAugmentLimit())};initialize()}]),angular.module("core").controller("HeaderController",["$document","$rootScope","$scope","Authentication","Menus",function($document,$rootScope,$scope,Authentication,Menus){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1}),$scope.fetchPcs=function(){$rootScope.$broadcast("fetchPcs"),$scope.isCollapsed=!1},$scope.fetchDecks=function(deckType){$rootScope.$broadcast("fetchDecks",{deckType:deckType}),$scope.isCollapsed=!1}}]),angular.module("core").directive("modalDialogWindow",function(){return{restrict:"E",scope:{show:"="},transclude:!0,templateUrl:"../modules/core/views/modal-window.html",link:function(scope,element,attrs){scope.dialogStyle={},attrs.width&&(scope.dialogStyle.width=attrs.width),attrs.height&&(scope.dialogStyle.height=attrs.height),scope.hideModal=function(){scope.show=!1}}}});var coreModule=angular.module("core");coreModule.directive("screenSize",["$rootScope","$window",function($rootScope,$window){return{restrict:"A",link:function(scope,element,attrs){var _windowHeight,_window=angular.element($window),initialize=function(){toggleListeners(!0),setTimeout(function(){onHeightChange()},0)},toggleListeners=function(enable){enable&&(scope.$on("$destroy",onDestroy),_window.on("resize",onHeightChange))},onDestroy=function(enable){toggleListeners(!1)},onHeightChange=function(){_windowHeight=_window.height(),$rootScope.$broadcast("screenSize:onHeightChange",{newHeight:_windowHeight})};angular.element(document).ready(function(){initialize()}),initialize()}}}]),angular.module("core").factory("bread-add",["$stateParams","$location","Authentication","$resource","$rootScope","BREAD",function($stateParams,$location,Authentication,$resource,$rootScope,BREAD){var service={};return service}]),angular.module("core").factory("bread-browse",["$stateParams","$location","Authentication","$resource","$rootScope","BREAD",function($stateParams,$location,Authentication,$resource,$rootScope,BREAD){var service={};return service}]),angular.module("core").factory("bread-delete",["$stateParams","$location","Authentication","$resource","$rootScope","BREAD",function($stateParams,$location,Authentication,$resource,$rootScope,BREAD){var service={};return service}]),angular.module("core").factory("bread-edit",["$stateParams","$location","Authentication","$resource","$rootScope","BREAD",function($stateParams,$location,Authentication,$resource,$rootScope,BREAD){var service={};return service}]),angular.module("core").factory("bread-read",["$stateParams","$location","Authentication","$resource","$rootScope","BREAD",function($stateParams,$location,Authentication,$resource,$rootScope,BREAD){var service={};return service}]),angular.module("core").factory("DataSRVC",[function($rootScope){var service={};return service.sexArray=["---","Male","Female"],service.diceList=[{order:1,name:"d__",sides:0,image:"modules/core/img/d___.png"},{order:2,name:"d4",sides:4,image:"modules/core/img/d_04.png"},{order:3,name:"d6",sides:6,image:"modules/core/img/d_06.png"},{order:4,name:"d6",sides:6,image:"modules/core/img/d_06.png"},{order:5,name:"d8",sides:8,image:"modules/core/img/d_08.png"},{order:6,name:"d8",sides:8,image:"modules/core/img/d_08.png"},{order:7,name:"d10",sides:10,image:"modules/core/img/d_10.png"},{order:8,name:"d10",sides:10,image:"modules/core/img/d_10.png"},{order:9,name:"d12",sides:12,image:"modules/core/img/d_12.png"}],service.targetTypes=["Utility","Close","Close Area","Distant","Distant Area"],service.closeDetails=["1/1","1/2","1/3","1/4","2/1","2/2","2/3","2/4","3/1","3/2","3/3","3/4","4/1","4/2","4/3"],service.closeAreaDetails=["2x2","3x3","4x4","5x5"],service.distantDetails=["4/1","6/1","8/1","10/1","12/1","14/1","16/1","18/1","20/1","22/1","24/1"],service.distantAreaDetails=["8/2x2","10/2x2","12/2x2","16/2x2","10/3x3","12/3x3","16/3x3","20/3x3","12/4x4","16/4x4","20/4x4"],service.actionKeywords=["Default","Single-use","Thrown","Reflexive","Melee","Ranged","Evocation","Invocation"],service.actionFrequency=["Free","Count: 1","Count: 2","Count: 3","Count: 4","Count: 5","Disruptive","Responsive"],service.dice=["1d4","1d6","1d8","1d10","1d12"],service.abilities=["STR","PHY","FLE","DEX","ACU","INT","WIS","CHA"],service.attackTypes=["Melee","Ranged","Evocation","Invocation"],service.defenseTypes=["Block","Dodge","Alertness","Tenacity"],service.prerequisites=["1d10 STR","1d10 PHY","1d10 FLE","1d10 DEX","1d10 ACU","1d10 INT","1d10 WIS","1d10 CHA"],service.aspectTypes=["Archetype","Allegiance","Race"],service.archetypes=["General","Guardian","Hunter","Mastermind","Champion"],service.allegiances=["Unaligned","Nymaria","Vakhelos","Heresy","Inquisition"],service.races=["Weolda","Algharr","Durhok","Feyal","Sylthaun"],service.itemTypes=["Melee","Melee / Ranged","Melee / Invocation","Ranged","Ranged / Melee","Ranged / Evocation","Evocation","Evocation / Invocation","Evocation / Ranged","Invocation","Invocation / Evocation","Invocation / Melee"],service.itemSlots=["One-handed","Two-handed","One-handed or Paired","One-handed or Two-handed","Armor","Shield","Gloves","Boots","Cloak","Amulet","Ring","Belt","Helmet","Consumable","Provision"],service}]);var coreModule=angular.module("core");coreModule.factory("HomeDemo",["$rootScope",function($rootScope){var service={};return service.cards={cardList:[{name:"A Trait Card",cardType:"trait",cardRole:"home",x_coord:0,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0},{name:"A Feat Card",cardType:"feat",cardRole:"home",x_coord:15,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0},{name:"An Augment Card",cardType:"augment",cardRole:"home",x_coord:30,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0,description:{show:!0,content:"Truly amazing..."}},{name:"An Item Card",cardType:"item",cardRole:"home",x_coord:45,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0},{name:"Another Feat Card",cardType:"feat",cardRole:"home",x_coord:60,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0},{name:"Another Item Card",cardType:"item",cardRole:"home",x_coord:75,y_coord:0,x_overlap:!1,y_overlap:!0,dragging:!1,stacked:!0,locked:!0,description:{show:!0,content:"This is the best one by far!!"}},{name:"Yet Another Feat Card",cardType:"feat",cardRole:"home",x_coord:75,y_coord:3,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!0,locked:!0}]},service}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),angular.module("core").factory("Socket",["socketFactory",function(socketFactory){var mSocket=socketFactory({ioSocket:socket});return mSocket}]),angular.module("decks").directive("cardDeck",["$rootScope","$window","CardDeck","BREAD",function($rootScope,$window,CardDeck,BREAD){return{restrict:"A",link:function(scope,element,attrs){var pressed=!1,initialize=function(){toggleListeners(!0)},toggleListeners=function(enable){enable&&(scope.$on("$destroy",onDestroy),element.on("mouseleave",onMouseLeave),scope.$on("screenSize:onHeightChange",onHeightChange),scope.$on("CardDeck:setDeckWidth",setDeckWidth),scope.$on("cardPanel:onPressCard",onPress),scope.$on("cardPanel:onReleaseCard",onRelease),scope.$on("cardPanel:onMoveCard",onMoveCard))},onDestroy=function(enable){toggleListeners(!1)},onHeightChange=function(event,object){var windowHeight=object.newHeight;element.css({height:windowHeight+"px"})},setDeckWidth=function(event,object){var deckWidth=object.deckWidth+3;element.css({width:deckWidth+"em"})},getElementFontSize=function(){return parseFloat($window.getComputedStyle(element[0],null).getPropertyValue("font-size"))},convertEm=function(value){return value*getElementFontSize()},onPress=function(){pressed=!0},onRelease=function(){pressed=!1},onMoveCard=function(event,object){var deckOffset=element.offset(),deckWidth=BREAD.deckWidth(),deckLeftEdge=deckOffset.left,deckRightEdge=convertEm(deckWidth+3);object.mouseX<=deckLeftEdge?scope.$emit("cardDeck:unstackLeft",{panel:object.panel}):object.mouseX>=deckRightEdge&&scope.$emit("cardDeck:unstackRight",{panel:object.panel})},onMouseLeave=function(event){pressed&&$rootScope.$broadcast("cardDeck:onMouseLeave")};initialize()}}}]),angular.module("decks").directive("cardPanel",["$document","$parse","$rootScope","$window","BREAD","CardDeck",function($document,$parse,$rootScope,$window,BREAD,CardDeck){return{restrict:"A",templateUrl:"../modules/decks/views/card-panel.html",link:function(scope,element,attrs){Array.min=function(array){return Math.min.apply(Math,array)};var _startX,_startY,_mouseX,_mouseY,_moveX,_moveY,_panelX,_panelY,_startCol,_mouseCol,_startRow,_mouseRow,_moveTimer,_x_dim,_y_dim,_x_tab,_y_tab,_x_cover,_y_cover,_dropdownOpen=!1,_panel=$parse(attrs.panel)||null,_hasTouch="ontouchstart"in window,_pressEvents="touchstart mousedown",_moveEvents="touchmove mousemove",_releaseEvents="touchend mouseup",_pressTimer=null,initialize=function(){element.attr("draggable","false"),toggleListeners(!0),$document.ready(function(){onHeightChange()})},toggleListeners=function(enable){enable&&(scope.$on("$destroy",onDestroy),scope.$watch(attrs.panel,onCardChange),scope.$on("screenSize:onHeightChange",onHeightChange),scope.$on("cardPanel:onPressCard",onPressCard),scope.$on("cardPanel:onMoveCard",onMoveCard),scope.$on("cardPanel:onReleaseCard",onReleaseCard),scope.$on("cardDeck:onMouseLeave",onMouseLeave),scope.$on("CardsCtrl:onDropdown",onDropdown),scope.$on("BREAD:onDeckChange",onReleaseCard),scope.$watch("panel.x_coord",resetPosition),scope.$watch("panel.y_coord",resetPosition),element.on(_pressEvents,onPress),_hasTouch||"img"!==element[0].nodeName.toLowerCase()||element.on("mousedown",function(){return!1}))},onDestroy=function(enable){toggleListeners(!1)},onCardChange=function(newVal,oldVal){_panel=newVal,element.css({top:"0",left:"-21em"}),setTimeout(function(){setPosition()},0)},onDropdown=function(event,object){_dropdownOpen=object.isOpen},getElementFontSize=function(){return parseFloat($window.getComputedStyle(element[0],null).getPropertyValue("font-size"))},convertEm=function(value){return value*getElementFontSize()},onHeightChange=function(event,object){_x_dim=convertEm(15),_y_dim=convertEm(21),_x_tab=convertEm(3),_y_tab=convertEm(3),_x_cover=convertEm(12),_y_cover=convertEm(18),setPosition()},resetPosition=function(newVal,oldVal){element.hasClass("card-moving")&&setPosition()},setPosition=function(){element.css({top:_panel.y_coord+"em",left:_panel.x_coord+"em"})},onPress=function(event){_dropdownOpen?$document.triggerHandler("click"):_hasTouch?(cancelPress(),_pressTimer=setTimeout(function(){cancelPress(),onLongPress(event)},100),$document.on(_moveEvents,cancelPress),$document.on(_releaseEvents,cancelPress)):_hasTouch||onLongPress(event)},cancelPress=function(){clearTimeout(_pressTimer),$document.off(_moveEvents,cancelPress),$document.off(_releaseEvents,cancelPress)},onLongPress=function(event){_startX=event.pageX||event.touches[0].pageX,_startY=event.pageY||event.touches[0].pageY,_moveX=0,_moveY=0,$document.on(_moveEvents,onMove),$document.on(_releaseEvents,onRelease),element.removeClass("card-moving"),$rootScope.$broadcast("cardPanel:onPressCard",{startX:_startX,startY:_startY,panel:_panel})},onPressCard=function(event,object){_startCol=convertEm(_panel.x_coord),_startRow=convertEm(_panel.y_coord);var panel=object.panel,panel_x=panel.x_coord,panel_y=panel.y_coord,panel_y_overlap=panel.y_overlap,slot=_panel,slot_x=slot.x_coord,slot_y=slot.y_coord;(slot_y!==panel_y||slot_x!==panel_x)&&(slot_x!==panel_x?element.addClass("card-moving"):slot_x!==panel_x&&slot_y>panel_y&&panel_y_overlap?element.addClass("card-moving"):slot_x!==panel_x||panel_y_overlap||element.addClass("card-moving"))},onMove=function(event){event.preventDefault(),_mouseX=event.pageX||event.touches[0].pageX,_mouseY=event.pageY||event.touches[0].pageY,_mouseCol=convertEm(_panel.x_coord),_mouseRow=convertEm(_panel.y_coord),_moveX=_mouseX-_startX,_moveY=_mouseY-_startY,_panelX=_moveX+_startCol-(_startCol-_mouseCol),_panelY=_moveY+_startRow-(_startRow-_mouseRow),element.css({left:_moveX+_startCol+"px",top:_moveY+_startRow+"px"}),$rootScope.$broadcast("cardPanel:onMoveCard",{mouseX:_mouseX,mouseY:_mouseY,moveX:_moveX,moveY:_moveY,panelX:_panelX,panelY:_panelY,panel:_panel})},onMoveCard=function(event,object){var mouseX=object.mouseX,mouseY=object.mouseY,moveX=object.moveX,moveY=object.moveY,vectorX=Math.abs(object.moveX),vectorY=Math.abs(object.moveY),panel=object.panel,panel_x=panel.x_coord,panel_y=panel.y_coord,panel_x_overlap=panel.x_overlap,panel_y_overlap=panel.y_overlap,slot=_panel,slot_x=slot.x_coord,slot_y=slot.y_coord,slot_x_overlap=slot.x_overlap,slot_y_overlap=slot.y_overlap,changeX=Math.abs(panel_x-slot_x),changeY=Math.abs(panel_y-slot_y);

0===changeX&&slot_y>panel_y&&panel_y_overlap?element.hasClass("card-moving")||element.css({left:_startCol+moveX+"px",top:_startRow+moveY+"px"}):(changeX>0||changeY>0)&&("top"===crossingEdge(mouseX,mouseY)?vectorX>0&&!slot_y_overlap&&!slot_x_overlap&&!panel_x_overlap?(console.log("cardSlot:moveDiagonalUp"),scope.$emit("cardSlot:moveDiagonalUp",{slot:slot,panel:panel})):0!==changeX||panel_y_overlap?(console.log("cardSlot:moveHorizontal"),scope.$emit("cardSlot:moveHorizontal",{slot:slot,panel:panel})):(console.log("cardSlot:moveVertical"),scope.$emit("cardSlot:moveVertical",{slot:slot,panel:panel})):"bottom"===crossingEdge(mouseX,mouseY)?changeX>0&&_x_dim>=changeX?(console.log("cardSlot:moveDiagonalDown"),scope.$emit("cardSlot:moveDiagonalDown",{slot:slot,panel:panel})):0!==changeX||panel_y_overlap?(console.log("cardSlot:moveHorizontal"),scope.$emit("cardSlot:moveHorizontal",{slot:slot,panel:panel})):(console.log("cardSlot:moveVertical"),scope.$emit("cardSlot:moveVertical",{slot:slot,panel:panel})):("left"===crossingEdge(mouseX,mouseY)||"right"===crossingEdge(mouseX,mouseY))&&(2*vectorY>vectorX?0>moveY?(console.log("cardSlot:moveDiagonalUp"),scope.$emit("cardSlot:moveDiagonalUp",{slot:slot,panel:panel})):moveY>0&&(console.log("cardSlot:moveDiagonalDown"),scope.$emit("cardSlot:moveDiagonalDown",{slot:slot,panel:panel})):(console.log("cardSlot:moveHorizontal"),scope.$emit("cardSlot:moveHorizontal",{slot:slot,panel:panel}))))},onRelease=function(){$document.off(_moveEvents,onMove),$document.off(_releaseEvents,onRelease),$rootScope.$broadcast("cardPanel:onReleaseCard",{panel:_panel}),_moveX<=convertEm(1)&&_moveX>=-convertEm(1)&&_moveY<=convertEm(1)&&_moveY>=-convertEm(1)&&$rootScope.$broadcast("cardPanel:toggleOverlap",{panel:_panel})},onReleaseCard=function(event,object){element.addClass("card-moving"),setTimeout(function(){setPosition()},0),clearTimeout(_moveTimer),_moveTimer=setTimeout(function(){element.removeClass("card-moving")},600)},onMouseLeave=function(){$document.off(_moveEvents,onMove),$document.off(_releaseEvents,onRelease),$rootScope.$broadcast("cardPanel:onReleaseCard",{panel:_panel})},crossingEdge=function(mouseX,mouseY){var cardOffset=element.offset(),slotX=cardOffset.left,slotY=cardOffset.top,leftEdge=_panel.x_overlap?slotX+_x_cover:slotX,rightEdge=slotX+_x_dim,topEdge=slotY,bottomEdge=_panel.y_overlap?slotY+_y_tab:slotY+_y_dim;if(mouseX>=leftEdge&&rightEdge>=mouseX&&mouseY>=topEdge&&bottomEdge>=mouseY){var left=mouseX-leftEdge,right=rightEdge-mouseX,top=mouseY-topEdge,bottom=bottomEdge-mouseY,edges=[left,right,top,bottom],closestEdge=Math.min.apply(Math.min,edges),edgeNames=["left","right","top","bottom"],edgeName=edgeNames[edges.indexOf(closestEdge)];return edgeName}};initialize()}}}]),angular.module("decks").factory("BREAD",["$stateParams","$location","Authentication","$resource","$rootScope","pcsDefaults","Decks","Pcs","Aspects","Traits","Feats","Augments","Items","Origins",function($stateParams,$location,Authentication,$resource,$rootScope,pcsDefaults,Decks,Pcs,Aspects,Traits,Feats,Augments,Items,Origins){var service={};service.resource={cardList:[]},service.dependencyList=[],service.findDependency=function(deck){for(var index=-1,i=0;i<service.resource.dependencies.length;i++){var dependency=service.resource.dependencies[i];dependency._id===deck._id&&(index=i)}return index},service.toggleDependency=function(deck){var deckIndex=service.findDependency(deck);deckIndex>-1?service.resource.dependencies.splice(deckIndex,1):service.resource.dependencies.push(deck)},service.lastCard=function(){for(var _last=0,_card={},i=0;i<service.resource.cardList.length;i++)service.resource.cardList[i].x_coord>(_card.x_coord||0)&&(_last=i,_card=service.resource.cardList[i]);return _last},service.deckWidth=function(){return service.resource.cardList?service.resource.cardList[service.lastCard()].x_coord+15:30};var setCardList=function(list,destination){destination.cardList=list;for(var i=0;i<list.length;i++)destination.cardList[i].x_coord=15*i,destination.cardList[i].y_coord=0,destination.cardList[i].x_overlap=!1,destination.cardList[i].y_overlap=!1,destination.cardList[i].dragging=!1,destination.cardList[i].stacked=!1;$rootScope.$broadcast("BREAD:onDeckChange")},removePanel=function(panel){for(var i=0;i<service.resource.cardList.length;i++)service.resource.cardList[i]===panel&&service.resource.cardList.splice(i,1)},shiftDeck=function(expand,panel){console.log(panel);var panel_x=panel.x_coord,x_shift=(panel.y_coord,expand?15:-15),_number=expand?1:-1,_length=service.resource.cardList.length-1;service.resource.deckSize=_length;for(var i=0;_length+1>i;i++){var slot=service.resource.cardList[i];slot.aspectData?slot.aspectData.cardSet=_length:slot.traitData?slot.traitData.cardSet=_length:slot.featData?slot.featData.cardSet=_length:slot.augmentData?slot.augmentData.cardSet=_length:slot.itemData?slot.itemData.cardSet=_length:slot.originData&&(slot.originData.cardSet=_length),console.log(panel_x),console.log(slot.x_coord),panel_x<=slot.x_coord&&panel!==slot&&(slot.x_coord+=x_shift,slot.aspectData?slot.aspectData.cardNumber+=_number:slot.traitData?slot.traitData.cardNumber+=_number:slot.featData?slot.featData.cardNumber+=_number:slot.augmentData?slot.augmentData.cardNumber+=_number:slot.itemData?slot.itemData.cardNumber+=_number:slot.originData&&(slot.originData.cardNumber+=_number))}$rootScope.$broadcast("BREAD:onDeckChange")};return service.toggleCardLock=function(panel){console.log(panel);for(var i=0;i<service.resource.cardList.length;i++)panel===service.resource.cardList[i]&&(service.resource.cardList[i].locked=!service.resource.cardList[i].locked)},service.changeAspect=function(card,aspect){console.log(card.aspect),console.log(aspect),card.aspect===aspect?console.log("same"):card.aspect=aspect},service.browseAspects=function(deck){console.log(deck),service.resource.archetypeList=[],service.resource.allegianceList=[],service.resource.raceList=[],Aspects.query({deckId:deck._id},function(response){for(var i=0;i<response.length;i++)console.log(response[i]),"Archetype"===response[i].aspectType?service.resource.archetypeList.push(response[i]):"Allegiance"===response[i].aspectType?service.resource.allegianceList.push(response[i]):"Race"===response[i].aspectType&&service.resource.raceList.push(response[i])})},service.browseCards=function(cardType,params,destination){"Aspect"===cardType?Aspects.query(params,function(response){return response}):"Trait"===cardType?Traits.query(params,function(response){return response}):"Feat"===cardType?Feats.query(params,function(response){return response}):"Augments"===cardType?Augments.query(params,function(response){return response}):"Items"===cardType?Items.query(params,function(response){return response}):"Origins"===cardType&&Origins.query(params,function(response){return response})},service.browseDecks=function(param,destination){param?Decks.query(param,function(response){destination===service.dependencyList?service.dependencyList=response:(response.unshift({cardRole:"architectOptions"}),setCardList(response,service.resource))}):Decks.list(function(response){response.unshift({cardRole:"architectOptions"}),setCardList(response,service.resource)})},service.browsePcs=function(){service.resource={},service.resource.cardList=[],Pcs.query(function(response){response.unshift({cardRole:"playerOptions"}),setCardList(response,service.resource)})},service.readCard=function(panel){var _card;"Aspect"===panel.cardRole?_card=Aspects.get({aspectId:panel.aspectData._id},function(response){panel.aspectData=response}):"Trait"===panel.cardRole?_card=Traits.get({traitId:panel.traitData._id},function(response){panel.traitData=response}):"Feat"===panel.cardRole?_card=Feats.get({featId:panel.featData._id},function(response){panel.featData=response}):"Augment"===panel.cardRole?_card=Augments.get({augmentId:panel.augmentData._id},function(response){panel.augmentData=response}):"Item"===panel.cardRole?_card=Items.get({itemId:panel.itemData._id},function(response){panel.itemData=response}):"Origin"===panel.cardRole&&(_card=Origins.get({originId:panel.originData._id},function(response){panel.originData=response}))},service.readDeck=function(deck){Decks.get({deckId:deck._id},function(response){if(service.resource=response,console.log(response),"Aspect"!==response.deckType){service.browseDecks({deckType:"Aspect"},service.dependencyList);for(var i=0;i<response.dependencies.length;i++)service.browseAspects(response.dependencies[i])}})},service.readPc=function(pc){service.resource=Pcs.get({pcId:pc._id})},service.editCard=function(panel){if("Aspect"===panel.cardRole)new Aspects(panel.aspectData).$update();else if("Trait"===panel.cardRole&&panel.traitData){var trait=new Traits(panel.traitData);trait.aspect&&(trait.aspect=panel.traitData.aspect._id),trait.$update()}else if("Feat"===panel.cardRole){var feat=new Feats(panel.featData);feat.aspect&&(feat.aspect=panel.featData.aspect._id),feat.$update()}else if("Augment"===panel.cardRole){var augment=new Augments(panel.augmentData);augment.aspect&&(augment.aspect=panel.augmentData.aspect._id),augment.$update()}else if("Item"===panel.cardRole){var item=new Items(panel.itemData);item.aspect&&(item.aspect=panel.itemData.aspect._id),item.$update()}else if("Origin"===panel.cardRole){var origin=new Origins(panel.originData);origin.aspect&&(origin.aspect=panel.itemData.aspect._id),origin.$update()}},service.editDeck=function(deck,_editCards,_loadDeck){var _deck=new Decks(deck);console.log(deck),_deck.$update(function(response){if(_editCards){for(var i=0;i<deck.cardList.length;i++){var panel=deck.cardList[i];service.editCard(panel)}$rootScope.$broadcast("BREAD: deckSaved")}_loadDeck&&(service.resource=response)},function(errorResponse){console.log(errorResponse)})},service.editPc=function(pc){pc.$update(function(response){},function(errorResponse){this.error=errorResponse.data.message})},service.addCard=function(deck,cardType,cardNumber,deckShift,deckSave){console.log(deck);var card={deck:deck._id,cardSet:deck.deckSize,cardNumber:cardNumber,cardType:cardType},panel={cardRole:cardType,x_coord:15*cardNumber,y_coord:0};"Aspect"===cardType?new Aspects(card).$save(function(response){panel.aspectData=response,deck.cardList.push(panel)}).then(function(response){deckShift&&shiftDeck(!0,panel)}).then(function(response){deckSave&&service.editDeck(deck,!1,!0)}):"Trait"===cardType?new Traits(card).$save(function(response){panel.traitData=response,deck.cardList.push(panel)}).then(function(response){deckShift&&shiftDeck(!0,panel)}).then(function(response){deckSave&&service.editDeck(deck,!1,!0)}):"Feat"===cardType?new Feats(card).$save(function(response){panel.featData=response,deck.cardList.push(panel)}).then(function(response){deckShift&&shiftDeck(!0,panel)}).then(function(response){deckSave&&service.editDeck(deck,!1,!0)}):"Augment"===cardType?new Augments(card).$save(function(response){panel.augmentData=response,deck.cardList.push(panel)}).then(function(response){deckShift&&shiftDeck(!0,panel)}).then(function(response){deckSave&&service.editDeck(deck,!1,!0)}):"Item"===cardType?new Items(card).$save(function(response){panel.itemData=response,deck.cardList.push(panel)}).then(function(response){deckShift&&shiftDeck(!0,panel)}).then(function(response){deckSave&&service.editDeck(deck,!1,!0)}):"Origin"===cardType&&new Origins(card).$save(function(response){panel.originData=response,deck.cardList.push(panel)}).then(function(response){deckShift&&shiftDeck(!0,panel)}).then(function(response){deckSave&&service.editDeck(deck,!1,!0)})},service.addDeck=function(type,size){console.log("addDeck");var deck=new Decks({name:type+" Deck",deckType:type,deckSize:size,cardList:[{cardRole:"deckOptions",x_coord:0,y_coord:0}]});deck.$save(function(response){for(var i=0;size>i;i++)service.addCard(deck,type,i+1,!1,i+1===size);"Aspect"!==type&&service.browseDecks({deckType:"Aspect"},service.dependencyList)})},service.addPc=function(){var pc=new Pcs(pcsDefaults);pc.$save(function(response){service.resource=response})},service.deleteCard=function(panel,_removePanel,_shiftDeck){panel.x_coord;"Aspect"===panel.cardRole?new Aspects(panel.aspectData).$remove(function(response){_removePanel&&removePanel(panel)}).then(function(response){_shiftDeck&&shiftDeck(!1,panel)}):"Trait"===panel.cardRole?new Traits(panel.traitData).$remove(function(response){_removePanel&&removePanel(panel)}).then(function(response){_shiftDeck&&shiftDeck(!1,panel)}):"Feat"===panel.cardRole?new Feats(panel.featData).$remove(function(response){_removePanel&&removePanel(panel)}).then(function(response){_shiftDeck&&shiftDeck(!1,panel)}):"Augment"===panel.cardRole?new Augments(panel.augmentData).$remove(function(response){_removePanel&&removePanel(panel)}).then(function(response){_shiftDeck&&shiftDeck(!1,panel)}):"Item"===panel.cardRole?new Items(panel.itemData).$remove(function(response){_removePanel&&removePanel(panel)}).then(function(response){_shiftDeck&&shiftDeck(!1,panel)}):"Origin"===panel.cardRole&&new Origins(panel.originData).$remove(function(response){_removePanel&&removePanel(panel)}).then(function(response){_shiftDeck&&shiftDeck(!1,panel)})},service.deleteDeck=function(deck){console.log(deck);for(var i=0;i<service.resource.cardList.length;i++)service.resource.cardList[i]===deck&&console.log(service.resource.cardList[i]);deck.$remove(function(response){removePanel(deck),setCardList(service.resource.cardList,service.resource);for(var ii=0;ii<response.cardList.length;ii++){var panel=response.cardList[ii];service.deleteCard(panel,!1,!1),"Aspect"===panel.cardRole?new Aspects(panel.aspectData).$remove():"Trait"===panel.cardRole?new Traits(panel.traitData).$remove():"Feat"===panel.cardRole?new Feats(panel.featData).$remove():"Augment"===panel.cardRole?new Augments(panel.augmentData).$remove():"Item"===panel.cardRole?new Items(panel.itemData).$remove():"Origin"===panel.cardRole&&new Origins(panel.originData).$remove()}})},service.deletePc=function(pc){pc.$remove(function(response){for(var i in service.resource.cardList)service.resource.cardList[i]===pc&&service.resource.cardList.splice(i,1)})},service}]),angular.module("decks").factory("Decks",["$resource",function($resource){return $resource("deck/:deckId",{deckId:"@_id"},{update:{method:"PUT"},list:{url:"/decks",method:"GET",isArray:!0},query:{url:"/decks/:deckType",method:"GET",isArray:!0,params:{deckType:"deckType"}}})}]),angular.module("core").factory("CardDeck",["BREAD","Campaigns","$rootScope",function(BREAD,Campaigns,$rootScope){var service={};service.windowHeight=0;var moveTimer,x_dim=15,y_dim=21,y_tab=3,x_cover=12,y_cover=18,_moveSpeed=800,cardMoved=!1,cardMoving=!1,getCardList=function(){return BREAD.resource.cardList},getCardIndex=function(x_coord,y_coord){for(var _deck=getCardList(),i=0;i<_deck.length;i++)if(_deck[i].x_coord===x_coord&&_deck[i].y_coord===y_coord)return i},getFirstIndex=function(){return getCardIndex(0,0)};service.getLastIndex=function(){for(var _deck=getCardList(),_card={},_last=0,i=0;i<_deck.length;i++)_deck[i].x_coord>(_card.x_coord||0)&&(_last=i,_card=_deck[i]);return _last},service.getDeckWidth=function(){var _deck=getCardList();return _deck[service.getLastIndex()].x_coord+x_dim};var setDeckWidth=function(){var _deck=getCardList(),_deckWidth=_deck[service.getLastIndex()].x_coord+x_dim;$rootScope.$broadcast("CardDeck:setDeckWidth",{deckWidth:_deckWidth})},getLastIndex=function(){for(var _deck=getCardList(),_card={},_last=0,i=0;i<_deck.length;i++)_deck[i].x_coord>(_card.x_coord||0)&&(_last=i,_card=_deck[i]);return _last},getLowestIndex=function(x_coord){for(var _deck=getCardList(),_card={},_lowest=0,i=0;i<_deck.length;i++)_deck[i].x_coord===x_coord&&_deck[i].y_coord>(_card.y_coord||-1)&&(_lowest=i,_card=_deck[i]);return _lowest},setColumn=function(x_coord){var _deck=getCardList(),lowest_index=getLowestIndex(x_coord),lowest_y_coord=_deck[lowest_index].y_coord;if(lowest_y_coord>0)for(var i=0;i<_deck.length;i++)_deck[i].x_coord===x_coord&&(_deck[i].stacked=!0,_deck[i].y_coord<lowest_y_coord?_deck[i].y_overlap=!0:_deck[i].y_overlap=!1);else _deck[lowest_index].stacked=!1,_deck[lowest_index].y_overlap=!1},initialize=function(){toggleListeners(!0)},toggleListeners=function(enable){enable&&($rootScope.$on("screenSize:onHeightChange",onHeightChange),$rootScope.$on("cardPanel:onPressCard",onPressCard),$rootScope.$on("cardPanel:onReleaseCard",onReleaseCard),$rootScope.$on("cardPanel:toggleOverlap",toggleOverlap),$rootScope.$on("cardSlot:moveHorizontal",moveHorizontal),$rootScope.$on("cardSlot:moveDiagonalUp",moveDiagonalUp),$rootScope.$on("cardSlot:moveDiagonalDown",moveDiagonalDown),$rootScope.$on("cardSlot:moveVertical",moveVertical),$rootScope.$on("cardDeck:unstackLeft",unstackLeft),$rootScope.$on("cardDeck:unstackRight",unstackRight))},onHeightChange=function(event,object){service.windowHeight=object.newHeight},setCardMoving=function(interval){clearTimeout(moveTimer),cardMoving=!0,cardMoved=!0,moveTimer=setTimeout(function(){cardMoving=!1,setDeckWidth()},interval)},onPressCard=function(event,object){var panel=object.panel,_deck=getCardList(),panel_x=panel.x_coord,panel_y=panel.y_coord,panel_index=getCardIndex(panel_x,panel_y);if(cardMoved=!1,_deck[panel_index].y_overlap)for(var ia=0;ia<_deck.length;ia++)_deck[ia].x_coord===panel_x&&_deck[ia].y_coord>=panel_y&&(_deck[ia].dragging=!0);else _deck[panel_index].dragging=!0;$rootScope.$digest()},onReleaseCard=function(event,object){{var panel=object.panel,_deck=getCardList();getCardIndex(panel.x_coord,panel.y_coord)}cardMoved=!1;for(var ia=0;ia<_deck.length;ia++)_deck[ia].dragging=!1;$rootScope.$digest()},moveHorizontal=function(event,object){{var _slot=object.slot,_panel=object.panel;getCardList(),getLowestIndex(_panel.x_coord)}_panel.y_coord>0||0===_panel.y_coord&&_panel.stacked&&!_panel.y_overlap?(console.log("unstackCard"),unstackCard(_slot,_panel)):0===_panel.y_coord&&(console.log("switchHorizontal"),switchHorizontal(_slot,_panel))},moveDiagonalUp=function(event,object){console.log("moveDiagonalUp");{var _slot=object.slot,_panel=object.panel;getCardList(),getLowestIndex(_panel.x_coord)}0===_panel.y_coord?stackUnder(_slot,_panel):unstackCard(_slot,_panel)},moveDiagonalDown=function(event,object){{var _slot=object.slot,_panel=object.panel;getCardList(),getLowestIndex(_panel.x_coord)}0===_panel.y_coord?stackOver(_slot,_panel):unstackCard(_slot,_panel)},moveVertical=function(event,object){switchVertical(object.slot,object.panel)},unstackLeft=function(event,object){if(object.panel.y_coord>0){var _panel=object.panel,_deck=getCardList(),unstack_coord=_deck[getFirstIndex()].x_coord-x_dim;unstackCard({x_coord:unstack_coord},_panel)}},unstackRight=function(event,object){if(object.panel.y_coord>0){var _panel=object.panel,_deck=getCardList(),unstack_coord=_deck[getLastIndex()].x_coord+x_dim;unstackCard({x_coord:unstack_coord},_panel)}},switchHorizontal=function(slot,panel){if(!cardMoving){var _deck=getCardList(),slot_x=slot.x_coord,slot_y=slot.y_coord,slot_index=getCardIndex(slot_x,slot_y),slot_x_overlap=slot.x_overlap,slot_position=slot_x,panel_x=panel.x_coord,panel_y=panel.y_coord,panel_index=getCardIndex(panel_x,panel_y),panel_x_overlap=panel.x_overlap,panel_width=x_dim;if(panel_x-slot_x>0){setCardMoving(_moveSpeed),0===slot_x&&panel_x_overlap?(slot_position=0,panel_width-=x_cover,_deck[slot_index].x_overlap=!0,_deck[panel_index].x_overlap=!1):(panel_x_overlap&&(panel_width-=x_cover,slot_position-=x_cover),slot_x_overlap&&(slot_position+=x_cover));for(var ia=0;ia<_deck.length;ia++)_deck[ia].x_coord>=slot_x&&_deck[ia].x_coord<panel_x?_deck[ia].x_coord+=panel_width:_deck[ia].x_coord===panel_x&&(_deck[ia].x_coord=slot_position)}else if(0>panel_x-slot_x){if(setCardMoving(_moveSpeed),0===panel_x&&slot_x_overlap){var first_index=getFirstIndex();_deck[first_index].x_overlap=!1,_deck[panel_index].x_overlap=!0,panel_width-=x_cover}else panel_x>0&&panel_x_overlap&&(panel_width-=x_cover);for(var ib=0;ib<_deck.length;ib++)_deck[ib].x_coord<=slot_x&&_deck[ib].x_coord>panel_x?_deck[ib].x_coord-=panel_width:_deck[ib].x_coord===panel_x&&(_deck[ib].x_coord=slot_position)}$rootScope.$digest()}},switchVertical=function(slot,panel){if(!cardMoving){{var _deck=getCardList(),slot_x=slot.x_coord,slot_y=slot.y_coord,slot_index=getCardIndex(slot_x,slot_y),slot_y_overlap=slot.y_overlap,panel_x=panel.x_coord,panel_y=panel.y_coord,panel_index=getCardIndex(panel_x,panel_y),panel_y_overlap=panel.y_overlap,lowest_index=getLowestIndex(slot_x);_deck[lowest_index].y_coord}panel_y-slot_y>0?(setCardMoving(_moveSpeed),_deck[slot_index].y_coord=panel_y,_deck[slot_index].y_overlap=panel_y_overlap,$rootScope.$digest(),_deck[panel_index].y_coord=slot_y,_deck[panel_index].y_overlap=slot_y_overlap):0>panel_y-slot_y&&(setCardMoving(_moveSpeed),_deck[slot_index].y_coord=panel_y,_deck[slot_index].y_overlap=panel_y_overlap,$rootScope.$digest(),_deck[panel_index].y_coord=slot_y,_deck[panel_index].y_overlap=slot_y_overlap),$rootScope.$digest()}},stackOver=function(slot,panel){if(!cardMoving&&!slot.x_overlap&&!panel.x_overlap){var _deck=getCardList(),slot_x=slot.x_coord,slot_y=slot.y_coord,slot_x_overlap=(getCardIndex(slot_x,slot_y),slot.x_overlap),panel_x=(slot.y_overlap,panel.x_coord),panel_y=panel.y_coord,panel_x_overlap=(getCardIndex(panel_x,panel_y),panel.x_overlap),panel_lowest_index=(panel.y_overlap,getLowestIndex(panel_x)),panel_lowest_coord=_deck[panel_lowest_index].y_coord,newColumn=panel_x>slot_x?slot_x:slot_x-x_dim;if(!slot_x_overlap&&!panel_x_overlap){setCardMoving(_moveSpeed);for(var ia=0;ia<_deck.length;ia++)!_deck[ia].dragging&&_deck[ia].x_coord===newColumn&&_deck[ia].y_coord>slot_y&&(_deck[ia].y_coord+=panel_lowest_coord+y_tab),_deck[ia].dragging&&(_deck[ia].x_coord=slot_x,_deck[ia].y_coord+=slot_y+y_tab-panel_y),_deck[ia].x_coord>panel_x&&0===panel_y&&(_deck[ia].x_coord-=x_dim);setColumn(newColumn),setColumn(slot_x),setColumn(panel_x)}$rootScope.$digest()}},stackUnder=function(slot,panel){if(!cardMoving&&!slot.x_overlap&&!panel.x_overlap){var _deck=getCardList(),panel_x=panel.x_coord,panel_y=panel.y_coord,panel_lowest_coord=(getCardIndex(panel_x,panel_y),panel.x_overlap,panel.y_overlap,_deck[getLowestIndex(panel_x)].y_coord),slot_x=slot.x_coord,slot_y=slot.y_coord,newColumn=(getCardIndex(slot_x,slot_y),_deck[getLowestIndex(slot_x)].y_coord,panel_x>slot_x?slot_x:slot_x-x_dim);setCardMoving(_moveSpeed);for(var ia=0;ia<_deck.length;ia++)_deck[ia].dragging||_deck[ia].x_coord!==slot_x||(_deck[ia].y_coord+=panel_lowest_coord+y_tab),_deck[ia].x_coord>panel_x&&(_deck[ia].x_coord-=x_dim),_deck[ia].dragging&&(_deck[ia].x_coord=newColumn);setColumn(newColumn),setColumn(slot_x),setColumn(panel_x),$rootScope.$digest()}},unstackCard=function(slot,panel){if(!cardMoving){var _deck=getCardList();if(_deck[getLowestIndex(panel.x_coord)].y_coord>0){var new_slot_index,new_panel_index,panel_x=panel.x_coord,panel_y=panel.y_coord,panel_index=getCardIndex(panel_x,panel_y),panel_y_overlap=(panel.x_overlap,panel.y_overlap),slot_x=slot.x_coord;if(panel_x-slot_x>0){if(setCardMoving(_moveSpeed),panel_y_overlap)for(var ia=0;ia<_deck.length;ia++)_deck[ia].x_coord>panel_x&&(_deck[ia].x_coord+=x_dim),_deck[ia].x_coord===panel_x&&panel_y_overlap&&(_deck[ia].y_coord<panel_y?_deck[ia].x_coord+=x_dim:_deck[ia].y_coord>=panel_y&&(_deck[ia].y_coord-=panel_y));else if(!panel_y_overlap){for(var ib=0;ib<_deck.length;ib++)_deck[ib].x_coord>=panel_x&&(_deck[ib].x_coord===panel_x&&_deck[ib].y_coord>panel_y&&(_deck[ib].y_coord-=y_dim),ib!==panel_index&&(_deck[ib].x_coord+=x_dim));_deck[panel_index].y_coord=0,_deck[panel_index].stacked=!1}new_slot_index=getLowestIndex(panel_x),new_panel_index=getLowestIndex(panel_x+x_dim),_deck[new_slot_index].y_overlap=!1,0===_deck[new_slot_index].y_coord&&(_deck[new_slot_index].stacked=!1),_deck[new_panel_index].y_overlap=!1,0===_deck[new_panel_index].y_coord&&(_deck[new_panel_index].stacked=!1)}else if(0>panel_x-slot_x&&!cardMoving){if(setCardMoving(_moveSpeed),panel_y_overlap)for(var ic=0;ic<_deck.length;ic++)_deck[ic].x_coord>panel_x&&(_deck[ic].x_coord+=x_dim),_deck[ic].x_coord===panel_x&&_deck[ic].y_coord>=panel_y&&(_deck[ic].x_coord+=x_dim,_deck[ic].y_coord-=panel_y);else if(!panel_y_overlap){for(var id=0;id<_deck.length;id++)_deck[id].x_coord>panel_x&&(_deck[id].x_coord+=x_dim),_deck[id].x_coord===panel_x&&_deck[id].y_coord>panel_y&&(_deck[id].y_coord-=y_dim);_deck[panel_index].x_coord+=x_dim,_deck[panel_index].y_coord=0}new_slot_index=getLowestIndex(panel_x),new_panel_index=getLowestIndex(slot_x),_deck[new_slot_index].y_overlap=!1,0===_deck[new_slot_index].y_coord&&(_deck[new_slot_index].stacked=!1),_deck[new_panel_index].y_overlap=!1,0===_deck[new_panel_index].y_coord&&(_deck[new_panel_index].stacked=!1)}}$rootScope.$digest()}},toggleOverlap=function(event,object){if(!cardMoved){var panel=object.panel,_deck=getCardList(),panel_x=panel.x_coord,panel_y=panel.y_coord,panel_x_overlap=panel.x_overlap,panel_y_overlap=panel.y_overlap,panel_index=getCardIndex(panel_x,panel_y),lowest_index=getLowestIndex(panel_x),lowest_y=_deck[lowest_index].y_coord;if(panel_x>0&&0===lowest_y){if(panel_x_overlap&&!cardMoving){setCardMoving(_moveSpeed),_deck[panel_index].x_overlap=!1;for(var ia=0;ia<_deck.length;ia++)panel_x<=_deck[ia].x_coord&&(_deck[ia].x_coord+=x_cover)}else if(!panel_x_overlap&&!cardMoving){setCardMoving(_moveSpeed),_deck[panel_index].x_overlap=!0;for(var ib=0;ib<_deck.length;ib++)panel_x<=_deck[ib].x_coord&&(_deck[ib].x_coord-=x_cover)}}else if(panel_y!==lowest_y)if(panel_y_overlap&&!cardMoving){setCardMoving(_moveSpeed),_deck[panel_index].y_overlap=!1;for(var ic=0;ic<_deck.length;ic++)panel_x===_deck[ic].x_coord&&panel_y<_deck[ic].y_coord&&(_deck[ic].y_coord+=y_cover)}else if(!panel_y_overlap&&!cardMoving){setCardMoving(_moveSpeed),_deck[panel_index].y_overlap=!0;for(var id=0;id<_deck.length;id++)panel_x===_deck[id].x_coord&&panel_y<_deck[id].y_coord&&(_deck[id].y_coord-=y_cover)}$rootScope.$digest(),cardMoved=!1}};return initialize(),service}]),angular.module("npcs").controller("NpcsController",["$scope","$stateParams","$location","Authentication","Npcs",function($scope,$stateParams,$location,Authentication,Npcs){$scope.authentication=Authentication,$scope.create=function(){var npc=new Npcs({name:this.name});npc.$save(function(response){$location.path("npcs/"+response._id),$scope.name=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(npc){if(npc){npc.$remove();for(var i in $scope.npcs)$scope.npcs[i]===npc&&$scope.npcs.splice(i,1)}else $scope.npc.$remove(function(){})},$scope.update=function(){var npc=$scope.npc;npc.$update(function(){},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.npcs=Npcs.query(function(response){console.log(response)})},$scope.findOne=function(){$scope.npc=Npcs.get({npcId:$stateParams.npcId})}}]),angular.module("npcs").factory("Npcs",["$resource",function($resource){return $resource("npcs/:npcId",{npcId:"@_id"},{update:{method:"PUT"}})}]),angular.module("pcs").directive("diceBox",["$window","CardDeck",function($window,CardDeck){return{restrict:"A",templateUrl:"../modules/pcs/views/dice-box.html",link:function(scope,element,attrs){var initialize=function(){element.attr("draggable","false"),toggleListeners(!0)},toggleListeners=function(enable){enable&&(scope.$on("$destroy",onDestroy),scope.$on("ability:onPress",setPosition),scope.$on("ability:setPosition",setPosition))},onDestroy=function(enable){toggleListeners(!1)},setPosition=function(event,object){var _caret=object.caret,_topEdge=object.topEdge,_leftEdge=object.leftEdge;element.removeClass("top-caret"),element.removeClass("bottom-caret"),element.addClass(_caret),element.css({top:_topEdge+"px",left:_leftEdge+"px"})};initialize()}}}]).directive("ability",["$parse","$rootScope","$window","CardDeck","PcsCard1",function($parse,$rootScope,$window,CardDeck,PcsCard1){return{restrict:"A",link:function(scope,element,attrs){var _ability=$parse(attrs.ability)||null,_pressEvents="touchstart mousedown",initialize=function(){element.attr("draggable","false"),toggleListeners(!0),onHeightChange()},toggleListeners=function(enable){enable&&(scope.$on("$destroy",onDestroy),scope.$watch(attrs.ability,onAbilityChange),scope.$on("screenSize:onHeightChange",onHeightChange),element.on(_pressEvents,onPress))},onDestroy=function(enable){toggleListeners(!1)},getElementFontSize=function(){return parseFloat($window.getComputedStyle(element[0],null).getPropertyValue("font-size"))},convertEm=function(value){return value*getElementFontSize()},onAbilityChange=function(newVal,oldVal){_ability=newVal},getPosition=function(){var offset=element.offset(),caret=_ability.order<4?"top-caret":"bottom-caret",topEdge=_ability.order<4?offset.top+convertEm(3):offset.top-convertEm(9),leftEdge=offset.left-convertEm(.5);return{caret:caret,topEdge:topEdge,leftEdge:leftEdge,ability:_ability}},onHeightChange=function(event,object){_ability.order===PcsCard1.chosenAbility.order&&$rootScope.$broadcast("ability:setPosition",getPosition())},onPress=function(){$rootScope.$broadcast("ability:onPress",getPosition())};initialize()}}}]),angular.module("pcs").directive("modalDeck",["$window","CardDeck",function($window,CardDeck){return{restrict:"A",templateUrl:"../modules/pcs/views/modal-deck.html",link:function(scope,element,attrs){}}}]),angular.module("decks").factory("Pcs",["$resource",function($resource){return $resource("pcs/:pcId",{pcId:"@_id"},{update:{method:"PUT"}})}]),angular.module("pcs").factory("PcsAugments",["BREAD","CardDeck",function(BREAD,CardDeck){var service={};return service.factorAugmentLimit=function(){BREAD.resource.augmentLimit=Math.round((BREAD.resource.level||0)/4),this.validateAugments()},service.validateAugments=function(){for(var ia=0;ia<BREAD.resource.augmentLimit;ia++)this.augmentAtLevel(4*ia+2)||this.addAugment(4*ia+2);for(var ic=0;ic<BREAD.resource.cardList.length;ic++)BREAD.resource.cardList[ic].level>BREAD.resource.level&&CardDeck.removeCard(ic)},service.augmentAtLevel=function(level){for(var augmentAtLevel=!1,ib=0;ib<BREAD.resource.cardList.length;ib++)"augment"===BREAD.resource.cardList[ib].cardType&&BREAD.resource.cardList[ib].level===level&&(augmentAtLevel=!0);return augmentAtLevel},service.addAugment=function(level){var newAugment={name:"Level "+level+" Augment",cardType:"augment",x_coord:BREAD.resource.cardList[BREAD.lastCard()].x_coord+15,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0,level:level};BREAD.resource.cardList.push(newAugment)},service}]),angular.module("pcs").factory("PcsCard1",["$rootScope","BREAD",function($rootScope,BREAD){var service={};return service.chosenDie={},service.previousDie={},service.chosenAbility={},service.chooseAbility=function(ability){service.chosenAbility=BREAD.resource.abilities[ability]},$rootScope.$on("ability:onPress",function(event,object){service.chosenAbility=BREAD.resource.abilities[object.ability.order]}),service.chooseDie=function(dice){service.modalShown=!1;var _abilityPair,_ability1,_ability2;switch(this.chosenDie=BREAD.resource.dicepool[dice],this.previousDie=this.chosenAbility.dice,BREAD.resource.dicepool[dice]=BREAD.resource.dicepool[0],this.previousDie.order>0&&(BREAD.resource.dicepool[this.previousDie.order]=this.previousDie),BREAD.resource.abilities[this.chosenAbility.order].dice=this.chosenDie,this.chosenAbility.order){case 0:case 1:_abilityPair=1,_ability1=BREAD.resource.abilities[0],_ability2=BREAD.resource.abilities[1];break;case 2:case 3:_abilityPair=2,_ability1=BREAD.resource.abilities[2],_ability2=BREAD.resource.abilities[3];break;case 4:case 5:_abilityPair=3,_ability1=BREAD.resource.abilities[4],_ability2=BREAD.resource.abilities[5];break;case 6:case 7:_abilityPair=4,_ability1=BREAD.resource.abilities[6],_ability2=BREAD.resource.abilities[7]}$rootScope.$broadcast("pcsCard1:updateAbility",{abilityPair:_abilityPair,ability1:_ability1,ability2:_ability2})},service.factorBlock=function(_str,_phy){Number(_str.dice.sides)>Number(_phy.dice.sides)?BREAD.resource.block="2"+_str.dice.name:BREAD.resource.block="2"+_phy.dice.name;

},service.factorDodge=function(_fle,_dex){Number(_fle.dice.sides)>Number(_dex.dice.sides)?BREAD.resource.dodge="2"+_fle.dice.name:BREAD.resource.dodge="2"+_dex.dice.name},service.factorAlertness=function(_acu,_int){Number(_acu.dice.sides)>Number(_int.dice.sides)?BREAD.resource.alertness="2"+_acu.dice.name:BREAD.resource.alertness="2"+_int.dice.name},service.factorTenacity=function(_wis,_cha){Number(_wis.dice.sides)>Number(_cha.dice.sides)?BREAD.resource.tenacity="2"+_wis.dice.name:BREAD.resource.tenacity="2"+_cha.dice.name},service}]),angular.module("pcs").factory("PcsCard2",["$rootScope","BREAD","PcsTraits",function($rootScope,BREAD,PcsTraits){var service={};return service.EXP=0,BREAD.resource&&(service.EXP=BREAD.resource.experience),service.factorExperience=function(){for(var mLevel=0,mExperience=Number(BREAD.resource.experience),increment=8;mExperience>=increment;increment++)mLevel++,mExperience-=increment;BREAD.resource.level=mLevel},service.factorHealth=function(){BREAD.resource.healthLimit=Math.round((Number(BREAD.resource.abilities[0].dice.sides)+Number(BREAD.resource.abilities[1].dice.sides))*((BREAD.resource.level||0)/16+1)),BREAD.resource.healthCurrent=Number(BREAD.resource.healthLimit-BREAD.resource.injury)},service.factorStamina=function(){BREAD.resource.staminaLimit=Math.round((Number(BREAD.resource.abilities[0].dice.sides)+Number(BREAD.resource.abilities[1].dice.sides))*((BREAD.resource.level||0)/16+1)),BREAD.resource.staminaCurrent=Number(BREAD.resource.healthLimit-BREAD.resource.injury)},service.factorCarryingCapacity=function(){BREAD.resource.carryCurrent=0,BREAD.resource.carryLimit=Number(BREAD.resource.abilities[0].dice.sides)+Number(BREAD.resource.abilities[1].dice.sides)},service}]),angular.module("pcs").factory("PcsCard3",["$rootScope","BREAD",function($rootScope,BREAD){var service={};return service}]),angular.module("pcs").factory("pcsDefaults",[function(){var defaultStats={abilities:[{name:"Strength",order:0,dice:{name:"d__",image:"modules/core/img/d___.png",sides:"0",order:0}},{name:"Physique",order:1,dice:{name:"d__",image:"modules/core/img/d___.png",sides:"0",order:0}},{name:"Flexibility",order:2,dice:{name:"d__",image:"modules/core/img/d___.png",sides:"0",order:0}},{name:"Dexterity",order:3,dice:{name:"d__",image:"modules/core/img/d___.png",sides:"0",order:0}},{name:"Acuity",order:4,dice:{name:"d__",image:"modules/core/img/d___.png",sides:"0",order:0}},{name:"Intelligence",order:5,dice:{name:"d__",image:"modules/core/img/d___.png",sides:"0",order:0}},{name:"Wisdom",order:6,dice:{name:"d__",image:"modules/core/img/d___.png",sides:"0",order:0}},{name:"Charisma",order:7,dice:{name:"d__",image:"modules/core/img/d___.png",sides:"0",order:0}}],dicepool:[{name:"d__",image:"modules/core/img/d___.png",sides:"0",order:0},{name:"d4",image:"modules/core/img/d_04.png",sides:"4",order:1},{name:"d6",image:"modules/core/img/d_06.png",sides:"6",order:2},{name:"d6",image:"modules/core/img/d_06.png",sides:"6",order:3},{name:"d8",image:"modules/core/img/d_08.png",sides:"8",order:4},{name:"d8",image:"modules/core/img/d_08.png",sides:"8",order:5},{name:"d10",image:"modules/core/img/d_10.png",sides:"10",order:6},{name:"d10",image:"modules/core/img/d_10.png",sides:"10",order:7},{name:"d12",image:"modules/core/img/d_12.png",sides:"12",order:8}],cardList:[{cardRole:"pc1",x_coord:0,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0},{cardRole:"pc2",x_coord:15,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0},{cardRole:"pc3",x_coord:30,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0},{name:"Level 0 Trait",cardRole:"featureCard",x_coord:45,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0,level:0}]};return defaultStats}]),angular.module("pcs").factory("PcsFeats",["BREAD","CardDeck",function(BREAD,CardDeck){var service={};return service.factorFeatLimit=function(){BREAD.resource.featLimit=Math.ceil(BREAD.resource.level/4)||0,BREAD.resource.featDeck=BREAD.resource.level,this.validateFeats()},service.validateFeats=function(){for(var ia=0;ia<BREAD.resource.featDeck;ia++)this.featAtLevel(ia+1)||this.addFeat(ia+1);for(var ic=0;ic<BREAD.resource.cardList.length;ic++)BREAD.resource.cardList[ic].level>BREAD.resource.level&&CardDeck.removeCard(BREAD.resource.cardList[ic])},service.featAtLevel=function(level){for(var featAtLevel=!1,ib=0;ib<BREAD.resource.cardList.length;ib++)"feat"===BREAD.resource.cardList[ib].cardType&&BREAD.resource.cardList[ib].level===level&&(featAtLevel=!0);return featAtLevel},service.addFeat=function(level){var newFeat={name:"Level "+level+" Feat",cardType:"feat",x_coord:BREAD.resource.cardList[BREAD.lastCard()].x_coord+15,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0,level:level};BREAD.resource.cardList.push(newFeat)},service}]),angular.module("pcs").factory("PcsItems",["BREAD",function(BREAD){var service={};return service}]),angular.module("pcs").factory("PcsTraits",["$resource","BREAD","CardDeck",function($resource,BREAD,CardDeck){{var service={};$resource("traits/:traitId",{traitId:"@_id"},{update:{method:"PUT"}})}return service.factorTraitLimit=function(){BREAD.resource.traitLimit=Math.floor((BREAD.resource.level||0)/4+1),this.validateTraits()},service.validateTraits=function(){for(var ia=0;ia<BREAD.resource.traitLimit;ia++)this.traitAtLevel(4*ia)||this.addTrait(4*ia);for(var ic=0;ic<BREAD.resource.cardList.length;ic++)BREAD.resource.cardList[ic].level>BREAD.resource.level&&CardDeck.removeCard(ic)},service.traitAtLevel=function(level){for(var traitAtLevel=!1,ib=0;ib<BREAD.resource.cardList.length;ib++)"trait"===BREAD.resource.cardList[ib].cardType&&BREAD.resource.cardList[ib].level===level&&(traitAtLevel=!0);return traitAtLevel},service.addTrait=function(level){var newTrait={name:"Level "+level+" Trait",cardType:"trait",x_coord:BREAD.resource.cardList[BREAD.lastCard()].x_coord+15,y_coord:0,x_overlap:!1,y_overlap:!1,dragging:!1,stacked:!1,locked:!0,level:level};BREAD.resource.cardList.push(newTrait)},service.lockCard=function(card){card.cardRole="player",card.locked=!0,card.x_coord=15*(card.cardNumber-1),card.y_coord=0,card.dragging=!1,card.stacked=!1},service}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invlaid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication",function($scope,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);